<!-- // If user is not signed in // -->
<div class="banner banner-important" ng-if="!vm.loggedIn && vm.closing != 'CLOSED'">
	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<p>To apply on this opportunity you need to <a href ui-sref="authentication.signin"> Sign In</a> or	<a href  id="authentication.gov" ui-sref="authentication.gov"> Sign Up</a></p>
			</div>
		</div>
	</div>
</div>

<!-- // If user doesn't have an email address in their profile // -->
<div class="banner banner-important" ng-if="vm.notifyMe && !vm.hasEmail">
	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<p>Want <span class="hidden-sm hidden-xs">to get </span>updates about this opportunity? <a href  id="settings.profile" ui-sref="settings.profile">  Add your email address.</a></p>
			</div>
		</div>
	</div>
</div>

<!-- // Admin View / Proposals section // -->

<section class="section admin" ng-if="vm.opportunity.status != 'Pending' || vm.canEdit && vm.opportunity.isPublished">
	
	<proposal-list ng-if="vm.opportunity.status === 'Pending' && vm.canEdit && vm.opportunity.isPublished" isclosed="vm.closing === 'CLOSED'" context="opportunity" opportunity="vm.opportunity" title="Proposals Received"></proposal-list>
	<br>

	<div class="container">	
		<div class="row" ng-if="vm.opportunity.status !== 'Pending' && vm.opportunity.proposal">
			<div class="col-xs-12">
				<p><span class="light">Assigned to:</span>
					&nbsp;&nbsp;  
					<img class="img-avatar-flat img-avatar-sm" src="{{((vm.opportunity.proposal.user.profileImageURL.substr(0,1) == '/' || vm.opportunity.proposal.user.profileImageURL.substr(0,4) == 'http') ? '' : '/') + vm.opportunity.proposal.user.profileImageURL}}"/>
					&nbsp;
					<span class="strong">{{vm.opportunity.proposal.user.firstName}} {{vm.opportunity.proposal.user.lastName}}</span>
					&nbsp;&nbsp;
					<a  id="proposals.view" ng-if="vm.canEdit || vm.isMember" ui-sref="proposals.view({ proposalId: vm.opportunity.proposal._id })">View Proposal</a>
					&nbsp;
					<button class="btn btn-sm btn-warning" ng-if="vm.canEdit" ng-click="vm.unassign()"><i class="fa fa-times-circle"></i> UNASSIGN</button>
				</p>
			</div>
		</div>

		<div class="row" ng-if="vm.canEdit && vm.closing === 'CLOSED'">
			<div class="col-xs-12">
				<a class="btn btn-default-inverse" href="/api/proposals/archive/opportunity/{{vm.opportunity._id}}" target="_blank"><i class="fa fa-file-archive-o"></i> Download .zip of all proposals</a>
			</div>
		</div>
	</div>

</section>

<!-- // Admin View / if opportunity is in DRAFT and INCOMPLETE // -->
<div class="banner banner-important"  ng-if="!vm.canPublish && vm.canEdit">
	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<h4 class="warning"><i class="fa fa-exclamation-triangle"></i> Your opportunity is missing stuff!</h4>
				<p>Before you can publish, you'll need to define these things:</p>
				<ul style="text-align: left;"><li ng-repeat="fname in vm.errorFields">{{fname}}</li></ul>
			</div>
		</div>
	</div>
</div>

<!-- // Admin Controls / if opportunity is in DRAFT and COMPLETE // -->
<div class="page-controls" ng-if="vm.canEdit && !vm.opportunity.isPublished">
	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<div class="btn-group pull-right" role="group" aria-label="">
					<button type="button" class="btn btn-sm btn-default" ng-if="vm.canEdit" ui-sref="opportunityadmin.edit({opportunityId:vm.opportunity.code})"><i class="fa fa-pencil"></i> EDIT</button>
					<a href="javascript:void(0);" ng-if="vm.canPublish && vm.opportunity.project.isPublished && vm.canEdit && !vm.opportunity.isPublished" class="btn btn-sm btn-warning" ng-click="vm.publish(vm.opportunity, true)"><i class="fa fa-bullhorn"></i> PUBLISH</a>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- // Admin Controls / if opportunity is PUBLISHED // -->
<div class="page-controls" ng-if="vm.canEdit && vm.opportunity.isPublished">
	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<div class="btn-group pull-right" role="group" aria-label="">
					<button type="button" class="btn btn-sm btn-default" ng-if="vm.canEdit" ui-sref="opportunityadmin.edit({opportunityId:vm.opportunity.code})"><i class="fa fa-pencil"></i> EDIT</button>
					<a href="javascript:void(0);" ng-if="vm.opportunity.project.isPublished && vm.canEdit && vm.opportunity.isPublished" class="btn btn-sm btn-default" ng-click="vm.publish(vm.opportunity, false)"><i class="fa fa-trash"></i> UNPUBLISH</a>
				</div>
			</div>
		</div>
	</div>
</div>




<!-- // Submit a proposal button // -->
<div class="row">
	<div class="col-xs-12">
		<proposal-apply ng-if="true && vm.closing !== 'CLOSED'" opportunity="vm.opportunity" proposal="vm.myproposal"></proposal-apply>
	</div>
</div>

<br>


<ng-include src="'/modules/opportunities/client/views/view-opportunity.cwu.view.html'" ng-if="!vm.showProposals && !vm.isSprintWithUs"></ng-include>
<ng-include src="'/modules/opportunities/client/views/view-opportunity.swu.view.html'" ng-if="!vm.showProposals && vm.isSprintWithUs"></ng-include>
<div class="container" role="main">
<div class="row" ng-if="vm.showProposals && !vm.isSprintWithUs">
	<uib-tabset active>
		<uib-tab index="0">
			<uib-tab-heading>
				Proposals
			</uib-tab-heading>
			<!-- // Admin View / Proposals section // -->
			<section class="admin" ng-if="vm.canEdit && vm.opportunity.isPublished">

				<proposal-list ng-if="vm.opportunity.status === 'Pending' && vm.canEdit && vm.opportunity.isPublished" isclosed="vm.closing === 'CLOSED'" context="opportunity" opportunity="vm.opportunity" title="Proposals received"></proposal-list>

				<div class="row" ng-if="vm.canEdit && vm.closing === 'CLOSED'">
					<div class="col-xs-12">
						<a class="btn btn-default" href="/api/proposals/archive/opportunity/{{vm.opportunity._id}}" target="_blank"><i class="fa fa-download"></i> Download Proposals Archive</a>
					</div>
				</div>

				<br>

				<div  ng-if="vm.opportunity.status !== 'Pending' && vm.opportunity.proposal">
					<h4>Opportunity Assigned to</h4>
					<div class="card card-block">
						<div class="card-img">
							<img class="card-img-left" src="{{((vm.opportunity.proposal.user.profileImageURL.substr(0,1) == '/' || vm.opportunity.proposal.user.profileImageURL.substr(0,4) == 'http') ? '' : '/') + vm.opportunity.proposal.user.profileImageURL}}"/>
						</div>

						<div class="col-md-5">
							<h4 class="card-title" style="font-size: 17px; padding-top: 6px; margin-bottom: 4px;">{{vm.opportunity.proposal.user.firstName}} {{vm.opportunity.proposal.user.lastName}}</h4>
							<p>Attachments: {{vm.opportunity.proposal.attachments.length}}</p>
						</div>

						<div class="col-md-2">
							<button class="btn btn-warning" ng-if="vm.canEdit" ng-click="vm.unassign()">UNASSIGN</button>
						</div>
						<div class="col-md-2" ng-if="vm.canEdit || vm.isMember">
							<a  id="proposals.view" ui-sref="proposals.view({ proposalId: vm.opportunity.proposal._id })">View Proposal</a><br/>
						</div>
					</div>
				</div>

			</section>
		</uib-tab>
		<uib-tab index="1" >
			<uib-tab-heading>
				Details
			</uib-tab-heading>
			<ng-include src="'/modules/opportunities/client/views/view-opportunity.cwu.view.html'"></ng-include>
		</uib-tab>
	</uib-tabset>
</div>
<div class="row" ng-if="vm.showProposals && vm.isSprintWithUs">
	<uib-tabset active>
		<uib-tab index="0">
			<uib-tab-heading>
				Proposals
			</uib-tab-heading>
			<div class="container">
				<br/>
				<div class="panel panel-info">
					<div class="panel-heading">
						<strong>Evaluation Matrix</strong>
					</div>
					<div class="panel-body">
						<p>
							Complete the Evaluation Matrix below.<br/>
							<ol>
								<li>
									How many teams do you wish to interview? <input type="text" class="form-input input-sm" width="1" ng-model="vm.nteams"/>
								</li>
								<li>
									Complete the <a href ng-click="vm.questions()">Question Ranking</a>
								</li>
								<li>
									Complete the Interview Ranking for each team
								</li>
								<li>
									At this point the price will be unmasked
								</li>
							</ol>
							<br/>
							<strong>Current Stage: <a href ng-click="vm.questions()">Question Ranking</a></strong>
						</p>

					</div>
					<table class="table table-condensed table-striped">
						<thead>
							<tr>
								<td><strong>Team</strong></td>
								<td align="center"><strong>Questions</strong></td>
								<td><strong>Interview</strong></td>
								<td><strong>Price (Target: 20,000)</strong></td>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>Team A</td>
								<td align="center"><span class="text-success"><i class="fa fa-check-circle"></i></span></td>
								<td><a href ng-click="vm.interview(1)">Score : ( TBD )</a></td>
								<td>Quote: ( TBD )</td>
							</tr>
							<tr>
								<td>Team B</td>
								<td align="center"><span class="text-success"><i class="fa fa-check-circle"></i></span></td>
								<td><a href ng-click="vm.interview(2)">Score : ( TBD )</a></td>
								<td>Quote: ( TBD )</td>
							</tr>
							<tr>
								<td>Team C</td>
								<td align="center"><span class="text-danger"><i class="fa fa-times-circle"></i></span></td>
								<td>N/A</td>
								<td>N/A</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</uib-tab>
		<uib-tab index="1" >
			<uib-tab-heading>
				Details
			</uib-tab-heading>
			<ng-include src="'/modules/opportunities/client/views/view-opportunity.swu.view.html'"></ng-include>
		</uib-tab>
	</uib-tabset>
</div>
</div>


<!-- // Record of Publish Date and Updates // -->
<div class="banner banner-gray">
	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<p><span class="small">Published on <span class="strong" ng-bind="vm.opportunity.lastPublished | date:'mediumDate'"></span> by <span ng-if="vm.opportunity.createdBy" ng-bind="vm.opportunity.createdBy.displayName"></span><span ng-if="!vm.opportunity.createdBy">Deleted User</span>&nbsp; &nbsp;
					Last updated on <span class="strong" ng-bind="vm.opportunity.updated | date:'mediumDate'"></span> by <span ng-if="vm.opportunity.updatedBy" ng-bind="vm.opportunity.updatedBy.displayName"></span>
					<span ng-if="!vm.opportunity.updatedBy">Deleted User</span>
					</span>
				</p>
			</div>
		</div>
	</div>
</div>
